<html>
    <head>
        <title>r/pics/frame</title>
        <link rel="stylesheet" type="text/css" 
        href="http://meyerweb.com/eric/tools/css/reset/reset.css"></link>
        <script type="text/javascript" 
        src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
        </script>
        <script type="text/javascript">
            $(document).ready(function() {

                var bwidth = $(document).width();
                var bheight = $(document).height();
                $('#width').html(bwidth + ' x ' + bheight);

                var directLink = new RegExp(
                '\.(jpg|jpeg|png|bmp|gif)$');

                var entries = [];
                var current = 1;
                $.getJSON('http://www.reddit.com/r/pics.json?jsonp=?&limit=100',
                function(data) {
                    var count = 0;
                    //var dimensions = [];
                    $.each(data.data.children, function(i, item) {
                        //alert(item.data.title);
                        if (directLink.test(item.data.url)) {
                            //alert(item.data.url);
                            entries[count] = [];
                            entries[count]['title'] = item.data.title;
                            entries[count]['url'] = item.data.url;
                            //entries[count]['image'] = new Image(300, 300);
                            //entries[count].image.src = item.data.url;
                            orig_image = new Image();
                            //orig_image.src = item.data.url;

                            //dimensions = resize(entries[count].image.width, 
                            //entries[count].image.height, bwidth, bheight);
                            var asdf = "asdf";
                            orig_image.onload = test(asdf);
                            //orig_image.onload = test(asdf); //{
                                /*dimensions = resize(orig_image.width, 
                                orig_image.height, bwidth, bheight);
                                entries[count]['width'] = dimensions[0];
                                entries[count]['height'] = dimensions[1];*/
                            //}
                            orig_image.src = item.data.url;
                            /*entries[count]['image'] = new Image(dimensions[0], 
                            dimensions[1]);
                            entries[count].image.src = orig_image.src;//item.data.url;*/
                            //alert(entries[count].width +' '+ entries[count].height);

                            count++;
                        }
                    });
                    alert(count + " total");
                    //alert(entries[0]['title']);
                    //alert(entries[0]['image']['width']);
                    place(0);
                });
                setInterval(function() {
                    place(current);
                    current ++;
                }, 15000);

                function test(asdf) {
                    alert(asdf);
                }

                function place(current) {

                    /*if (! entries[current].image.complete) {
                        alert("image not loaded");
                        $('#image2').html("Image still loading.");
                        setTimeout(place(current), 75);
                    }*/

                    $('#title').html(entries[current].title);//+ ' ' + current);
                    $('#image').attr('src', entries[current].url).width(entries[current].width).height(entries[current].height);
                    alert(entries[current].width + ' x ' +
                        entries[current].height);

                    //$('#image2').html('').width(entries[current].width).height(entries[current].height).append(entries[current].image);
                    //$('#image2').html('').append(entries[current].image);//.css('width', entries[current].width).css('height', entries[current].height);
                    //$('#image').css('width', entries[current].width).css('height', entries[current].height).attr('src', entries[current].url);

                    $('#url').attr('href', entries[current].url).html(
                    entries[current].url);
                }

                // b for browser, i for image, n for new
                function resize(iwidth, iheight, bwidth, bheight) {
                    //alert(width);
                    //alert(image.width);
                    if (iwidth > bwidth) {
                        var nheight = 
                        (iheight / (iwidth / bwidth));
                        return [parseInt(bwidth), parseInt(nheight)];
                    } else { 
                        return [parseInt(iwidth), parseInt(iheight)];
                    }
                }

            });
        </script>
    </head>
    <body>
        <center id='width'></center>
        <center id="title"></center>
        <center><img id="image"></img></center>
        <center><div id='image2'></div></center>
        <center><a id="url"></a></center>
    </body>
</html>
